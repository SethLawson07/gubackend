// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

model User {
    id              String         @id @default(auto()) @map("_id") @db.ObjectId()
    user_name       String
    email           String?        @unique
    agentId         String?        @db.ObjectId
    agent           User?          @relation("agent_customeur", fields: [agentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    customers       User[]         @relation(name: "agent_customeur")
    password        String
    phone           String         @unique
    profile_picture String
    is_admin        Boolean
    finance_pro_id  String?        @default("")
    is_verified     Boolean?       @default(false)
    role            String //customer,agent,delivery_man,command_handler,admin
    first_login     Boolean        @default(true)
    device_token    String         @default("")
    location        String?
    Contribution    Contribution[]
    Commission      Commission[]
    Activity        Activity[]
    RepCustomer     Report[]       @relation("Customer")
    RepAgent        Report[]       @relation("Agent")
    CBetReport      BetReport[]    @relation("BRCustomer")
    ABetReport      BetReport[]    @relation("BRAgent")
    Book            Book[]
    Account         Account[]
}

model Account {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    number    String
    type      String // saving, tontine
    user      User     @relation(fields: [userId], references: [id])
    userId    String   @db.ObjectId()
    balance   Float
    createdAt DateTime
}

type Case {
    id                 String @map("_id") @db.ObjectId
    contributionStatus String @default("unpaid") // ["paid","unpaid","awaiting"]
    sheet              String
    index              Int
}

type Sheet {
    id          String    @map("_id") @db.ObjectId
    createdAt   DateTime
    openedAt    DateTime?
    closeAt     DateTime?
    cases       Case[]
    bet         Int?
    status      String // "notopened" "opened" "closed"
    book        String
    index       Int
    closeReason String?
}

model Book {
    id          String   @id @default(auto()) @map("_id") @db.ObjectId
    customer    User     @relation(fields: [userId], references: [id])
    bookNumber  String
    createdAt   DateTime
    status      String // "*()notopened" "opened" "closed"
    sheets      Sheet[]
    closeReason String?
    userId      String   @db.ObjectId()
}

model Contribution {
    id           String      @id @default(auto()) @map("_id") @db.ObjectId
    customer     User        @relation(fields: [userId], references: [id])
    userId       String      @db.ObjectId()
    cases        Int[]
    sheet        String
    amount       Float       @default(0.0)
    agent        String?
    admin        String?
    pmethod      String      @default("") // (payment method)  agent, tmoney, moovmoney
    awaiting     String      @default("") // agent, admin, none
    status       String      @default("unpaid") //paid, unpaid, awaiting, rejected
    createdAt    DateTime
    report       Report      @relation(fields: [reportId], references: [id])
    reportId     String      @db.ObjectId
    commission   Commission? @relation(fields: [commissionId], references: [id])
    commissionId String?     @db.ObjectId
}

model Notification {
    id      String @id @default(auto()) @map("_id") @db.ObjectId
    user    String
    title   String
    message String
    status  String @default("unseen") // seen, unseen
}

model Caroussel {
    id          String @id @default(auto()) @map("_id") @db.ObjectId
    code        String
    link        String
    image       String
    title       String
    linkText    String
    buttomText  String
    description String
}

model CarousselService {
    id          String @id @default(auto()) @map("_id") @db.ObjectId
    code        String
    image       String
    description String
}

model Deposit {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    account   String
    customer  String
    createdAt DateTime
    payment   String // agent,tmoney,moovmoney
    amount    Float
    madeby    String // User transaction (User role) or agent, tmoney, moovmoney
    report    Report   @relation(fields: [reportId], references: [id])
    reportId  String   @db.ObjectId
}

model Activity {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId
    user      User     @relation(fields: [userId], references: [id])
    userId    String   @db.ObjectId()
    title     String?  @default("")
    type      String // deposit, contribution, delivery
    body      String?
    amount    Float?   @default(0)
    createdat DateTime
}

model Commission {
    id       String @id @default(auto()) @map("_id") @db.ObjectId
    amount   Float
    customer User   @relation(fields: [userId], references: [id])
    userId   String @db.ObjectId()
    sheet    String
    payment  String // agent, flooz, tmoney

    createdat    DateTime
    Contribution Contribution[]
}

model Report {
    id      String @id @default(auto()) @map("_id") @db.ObjectId
    payment String // agent, tmoney, flooz
    cases   Int[]
    sheet   Sheet?
    type    String // contribution, deposit

    amount      Float
    createdat   DateTime
    validatedat DateTime?

    customer   User   @relation("Customer", fields: [customerId], references: [id])
    customerId String @db.ObjectId()

    agent   User?   @relation("Agent", fields: [agentId], references: [id])
    agentId String? @db.ObjectId()

    status       String
    Contribution Contribution[]
    Deposit      Deposit[]
}

// For reports
model BetReport {
    id              String   @id @default(auto()) @map("_id") @db.ObjectId
    goodnessbalance Float // Gain Goodness 
    agentbalance    Float // Gain Agent 
    customer        User     @relation("BRCustomer", fields: [customerId], references: [id])
    customerId      String   @db.ObjectId()
    agent           User?    @relation("BRAgent", fields: [agentId], references: [id])
    agentId         String?  @db.ObjectId()
    type            String // book, bet
    createdat       DateTime
}

model Banner {
    id        String   @id @default(auto()) @map("_id") @db.ObjectId()
    name      String   @default("No_name")
    image     String
    link      String
    createdat DateTime
    featured  Boolean  @default(true)
}
